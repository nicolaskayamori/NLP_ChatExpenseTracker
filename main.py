import random
import spacy
from spacy.util import minibatch
from spacy.training.example import Example
nlp = spacy.load("pt_core_news_lg")
doc = nlp('paguei 30 reais em duas pizzas no Pizza Hut')
print([(w.text, w.pos_) for w in doc])
if 'ner' not in nlp.pipe_names:
    ner = nlp.add_pipe('ner')
else:
    ner = nlp.get_pipe('ner')
    


train_data = [('fix um pix de 27 em sorvete', {'entities': [(14, 16, 'VALOR'), (20, 27, 'PRODUTO')]}), ('mercado custou 22 prata', {'entities': [(15, 17, 'VALOR'), (0, 7, 'PRODUTO')]}), ('mandei 5 reais pra fulano trazer bar pra gente', {'entities': [(7, 8, 'VALOR'), (33, 36, 'PRODUTO')]}), ('paguei 25 conto em gasolina', {'entities': [(7, 9, 'VALOR'), (19, 27, 'PRODUTO')]}), ('fix um pix de 60 em hamburguer', {'entities': [(14, 16, 'VALOR'), (20, 30, 'PRODUTO')]}), ('gastei 40 reais em lanche', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('gastei 25 reais em livros', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('enviei 27 reais para comprar gasolina', {'entities': [(7, 9, 'VALOR'), (29, 37, 'PRODUTO')]}), ('enviei 20 reais para comprar pizza', {'entities': [(7, 9, 'VALOR'), (29, 34, 'PRODUTO')]}), ('foram 40 reais em sorvete', {'entities': [(6, 8, 'VALOR'), (18, 25, 'PRODUTO')]}), ('mandei 25 reais pra fulano trazer hamburguer pra gente', {'entities': [(7, 9, 'VALOR'), (34, 44, 'PRODUTO')]}), ('foram 55 reais em uber', {'entities': [(6, 8, 'VALOR'), (18, 22, 'PRODUTO')]}), ('50 reais gastos em restaurante', {'entities': [(0, 2, 'VALOR'), (19, 30, 'PRODUTO')]}), ('mandei 50 reais pra fulano trazer hamburguer pra gente', {'entities': [(7, 9, 'VALOR'), (34, 44, 'PRODUTO')]}), ('mandei 32 reais pra fulano trazer livros pra gente', {'entities': [(7, 9, 'VALOR'), (34, 40, 'PRODUTO')]}), ('mandei 30 reais pra fulano trazer hamburguer pra gente', {'entities': [(7, 9, 'VALOR'), (34, 44, 'PRODUTO')]}), ('gastei 15 reais em livros', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('15 reais gastos em cinema', {'entities': [(0, 2, 'VALOR'), (19, 25, 'PRODUTO')]}), ('paguei 55 conto em gasolina', {'entities': [(7, 9, 'VALOR'), (19, 27, 'PRODUTO')]}), ('foram 7 reais em farmácia', {'entities': [(6, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('paguei 18 reais por café', {'entities': [(7, 9, 'VALOR'), (20, 24, 'PRODUTO')]}), ('gastei 15 reais em café', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('fix um pix de 35 em taxi', {'entities': [(14, 16, 'VALOR'), (20, 24, 'PRODUTO')]}), ('mandei 20 reais pra fulano trazer pizza pra gente', {'entities': [(7, 9, 'VALOR'), (34, 39, 'PRODUTO')]}), ('paguei 12 reais por cartão', {'entities': [(7, 9, 'VALOR'), (20, 26, 'PRODUTO')]}), ('gasolina custou 27 prata', {'entities': [(16, 18, 'VALOR'), (0, 8, 'PRODUTO')]}), ('gastei 45 reais em hamburguer', {'entities': [(7, 9, 'VALOR'), (19, 29, 'PRODUTO')]}), ('paguei 7 conto em cinema', {'entities': [(7, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('mercado custou 22 prata', {'entities': [(15, 17, 'VALOR'), (0, 7, 'PRODUTO')]}), ('enviei 18 reais para comprar estacionamento', {'entities': [(7, 9, 'VALOR'), (29, 43, 'PRODUTO')]}), ('mandei 45 reais pra fulano trazer sorvete pra gente', {'entities': [(7, 9, 'VALOR'), (34, 41, 'PRODUTO')]}), ('fix um pix de 15 em restaurante', {'entities': [(14, 16, 'VALOR'), (20, 31, 'PRODUTO')]}), ('7 reais gastos em cartão', {'entities': [(0, 1, 'VALOR'), (18, 24, 'PRODUTO')]}), ('enviei 7 reais para comprar sorvete', {'entities': [(7, 8, 'VALOR'), (28, 35, 'PRODUTO')]}), ('fix um pix de 22 em cinema', {'entities': [(14, 16, 'VALOR'), (20, 26, 'PRODUTO')]}), ('fix um pix de 5 em posto de gasolina', {'entities': [(14, 15, 'VALOR'), (19, 36, 'PRODUTO')]}), ('paguei 15 conto em taxas', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('pizza custou 5 prata', {'entities': [(13, 14, 'VALOR'), (0, 5, 'PRODUTO')]}), ('usei 15 reais em cartão', {'entities': [(5, 7, 'VALOR'), (17, 23, 'PRODUTO')]}), ('enviei 27 reais para comprar estacionamento', {'entities': [(7, 9, 'VALOR'), (29, 43, 'PRODUTO')]}), ('enviei 12 reais para comprar lanche', {'entities': [(7, 9, 'VALOR'), (29, 35, 'PRODUTO')]}), ('usei 30 reais em farmácia', {'entities': [(5, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('10 reais gastos em bar', {'entities': [(0, 2, 'VALOR'), (19, 22, 'PRODUTO')]}), ('gastei 30 reais em hamburguer', {'entities': [(7, 9, 'VALOR'), (19, 29, 'PRODUTO')]}), ('55 reais gastos em taxi', {'entities': [(0, 2, 'VALOR'), (19, 23, 'PRODUTO')]}), ('enviei 32 reais para comprar taxi', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('18 reais gastos em estacionamento', {'entities': [(0, 2, 'VALOR'), (19, 33, 'PRODUTO')]}), ('mandei 32 reais pra fulano trazer bar pra gente', {'entities': [(7, 9, 'VALOR'), (34, 37, 'PRODUTO')]}), ('gastei 35 reais em taxi', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('foram 10 reais em cartão', {'entities': [(6, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('foram 15 reais em cinema', {'entities': [(6, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('usei 5 reais em livros', {'entities': [(5, 6, 'VALOR'), (16, 22, 'PRODUTO')]}), ('gastei 40 reais em taxas', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('foram 18 reais em mercado', {'entities': [(6, 8, 'VALOR'), (18, 25, 'PRODUTO')]}), ('foram 50 reais em restaurante', {'entities': [(6, 8, 'VALOR'), (18, 29, 'PRODUTO')]}), ('fix um pix de 27 em roupa', {'entities': [(14, 16, 'VALOR'), (20, 25, 'PRODUTO')]}), ('paguei 25 reais por estacionamento', {'entities': [(7, 9, 'VALOR'), (20, 34, 'PRODUTO')]}), ('gastei 12 reais em uber', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('paguei 65 reais por bar', {'entities': [(7, 9, 'VALOR'), (20, 23, 'PRODUTO')]}), ('fix um pix de 65 em café', {'entities': [(14, 16, 'VALOR'), (20, 24, 'PRODUTO')]}), ('paguei 40 conto em gasolina', {'entities': [(7, 9, 'VALOR'), (19, 27, 'PRODUTO')]}), ('enviei 60 reais para comprar uber', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('enviei 45 reais para comprar taxas', {'entities': [(7, 9, 'VALOR'), (29, 34, 'PRODUTO')]}), ('gastei 40 reais em roupa', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('paguei 20 conto em uber', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('enviei 60 reais para comprar café', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('usei 7 reais em livros', {'entities': [(5, 6, 'VALOR'), (16, 22, 'PRODUTO')]}), ('uber custou 30 prata', {'entities': [(12, 14, 'VALOR'), (0, 4, 'PRODUTO')]}), ('usei 40 reais em lanche', {'entities': [(5, 7, 'VALOR'), (17, 23, 'PRODUTO')]}), ('foram 35 reais em hotel', {'entities': [(6, 8, 'VALOR'), (18, 23, 'PRODUTO')]}), ('sorvete custou 5 prata', {'entities': [(15, 16, 'VALOR'), (0, 7, 'PRODUTO')]}), ('cinema custou 10 prata', {'entities': [(14, 16, 'VALOR'), (0, 6, 'PRODUTO')]}), ('mandei 50 reais pra fulano trazer pizza pra gente', {'entities': [(7, 9, 'VALOR'), (34, 39, 'PRODUTO')]}), ('gastei 18 reais em roupa', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('usei 22 reais em pizza', {'entities': [(5, 7, 'VALOR'), (17, 22, 'PRODUTO')]}), ('paguei 50 reais por gasolina', {'entities': [(7, 9, 'VALOR'), (20, 28, 'PRODUTO')]}), ('gastei 25 reais em livros', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('gastei 70 reais em taxas', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('7 reais gastos em roupa', {'entities': [(0, 1, 'VALOR'), (18, 23, 'PRODUTO')]}), ('12 reais gastos em sorvete', {'entities': [(0, 2, 'VALOR'), (19, 26, 'PRODUTO')]}), ('mandei 60 reais pra fulano trazer restaurante pra gente', {'entities': [(7, 9, 'VALOR'), (34, 45, 'PRODUTO')]}), ('foram 30 reais em mercado', {'entities': [(6, 8, 'VALOR'), (18, 25, 'PRODUTO')]}), ('posto de gasolina custou 32 prata', {'entities': [(25, 27, 'VALOR'), (0, 17, 'PRODUTO')]}), ('enviei 40 reais para comprar taxas', {'entities': [(7, 9, 'VALOR'), (29, 34, 'PRODUTO')]}), ('bar custou 32 prata', {'entities': [(11, 13, 'VALOR'), (0, 3, 'PRODUTO')]}), ('enviei 18 reais para comprar roupa', {'entities': [(7, 9, 'VALOR'), (29, 34, 'PRODUTO')]}), ('fix um pix de 40 em mercado', {'entities': [(14, 16, 'VALOR'), (20, 27, 'PRODUTO')]}), ('paguei 40 conto em taxas', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('enviei 45 reais para comprar cartão', {'entities': [(7, 9, 'VALOR'), (29, 35, 'PRODUTO')]}), ('gastei 20 reais em taxi', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('mandei 30 reais pra fulano trazer bar pra gente', {'entities': [(7, 9, 'VALOR'), (34, 37, 'PRODUTO')]}), ('fix um pix de 15 em gasolina', {'entities': [(14, 16, 'VALOR'), (20, 28, 'PRODUTO')]}), ('usei 35 reais em farmácia', {'entities': [(5, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('fix um pix de 40 em hamburguer', {'entities': [(14, 16, 'VALOR'), (20, 30, 'PRODUTO')]}), ('gastei 5 reais em pizza', {'entities': [(7, 8, 'VALOR'), (18, 23, 'PRODUTO')]}), ('bar custou 25 prata', {'entities': [(11, 13, 'VALOR'), (0, 3, 'PRODUTO')]}), ('10 reais gastos em estacionamento', {'entities': [(0, 2, 'VALOR'), (19, 33, 'PRODUTO')]}), ('paguei 35 conto em livros', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('fix um pix de 20 em taxi', {'entities': [(14, 16, 'VALOR'), (20, 24, 'PRODUTO')]}), ('enviei 20 reais para comprar mercado', {'entities': [(7, 9, 'VALOR'), (29, 36, 'PRODUTO')]}), ('paguei 20 reais por sorvete', {'entities': [(7, 9, 'VALOR'), (20, 27, 'PRODUTO')]}), ('roupa custou 45 prata', {'entities': [(13, 15, 'VALOR'), (0, 5, 'PRODUTO')]}), ('usei 18 reais em taxi', {'entities': [(5, 7, 'VALOR'), (17, 21, 'PRODUTO')]}), ('enviei 5 reais para comprar lanche', {'entities': [(7, 8, 'VALOR'), (28, 34, 'PRODUTO')]}), ('paguei 70 conto em mercado', {'entities': [(7, 9, 'VALOR'), (19, 26, 'PRODUTO')]}), ('mandei 27 reais pra fulano trazer livros pra gente', {'entities': [(7, 9, 'VALOR'), (34, 40, 'PRODUTO')]}), ('paguei 10 conto em sorvete', {'entities': [(7, 9, 'VALOR'), (19, 26, 'PRODUTO')]}), ('fix um pix de 20 em lanche', {'entities': [(14, 16, 'VALOR'), (20, 26, 'PRODUTO')]}), ('70 reais gastos em cartão', {'entities': [(0, 2, 'VALOR'), (19, 25, 'PRODUTO')]}), ('70 reais gastos em cartão', {'entities': [(0, 2, 'VALOR'), (19, 25, 'PRODUTO')]}), ('fix um pix de 45 em posto de gasolina', {'entities': [(14, 16, 'VALOR'), (20, 37, 'PRODUTO')]}), ('usei 55 reais em lanche', {'entities': [(5, 7, 'VALOR'), (17, 23, 'PRODUTO')]}), ('usei 5 reais em bar', {'entities': [(5, 6, 'VALOR'), (16, 19, 'PRODUTO')]}), ('enviei 55 reais para comprar cinema', {'entities': [(7, 9, 'VALOR'), (29, 35, 'PRODUTO')]}), ('paguei 40 reais por taxi', {'entities': [(7, 9, 'VALOR'), (20, 24, 'PRODUTO')]}), ('enviei 50 reais para comprar posto de gasolina', {'entities': [(7, 9, 'VALOR'), (29, 46, 'PRODUTO')]}), ('foram 25 reais em taxas', {'entities': [(6, 8, 'VALOR'), (18, 23, 'PRODUTO')]}), ('mandei 22 reais pra fulano trazer sorvete pra gente', {'entities': [(7, 9, 'VALOR'), (34, 41, 'PRODUTO')]}), ('paguei 45 reais por gasolina', {'entities': [(7, 9, 'VALOR'), (20, 28, 'PRODUTO')]}), ('lanche custou 18 prata', {'entities': [(14, 16, 'VALOR'), (0, 6, 'PRODUTO')]}), ('gastei 5 reais em cartão', {'entities': [(7, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('gastei 60 reais em gasolina', {'entities': [(7, 9, 'VALOR'), (19, 27, 'PRODUTO')]}), ('enviei 45 reais para comprar taxi', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('foram 27 reais em livros', {'entities': [(6, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('40 reais gastos em estacionamento', {'entities': [(0, 2, 'VALOR'), (19, 33, 'PRODUTO')]}), ('enviei 18 reais para comprar sorvete', {'entities': [(7, 9, 'VALOR'), (29, 36, 'PRODUTO')]}), ('gastei 35 reais em pizza', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('usei 22 reais em farmácia', {'entities': [(5, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('foram 40 reais em posto de gasolina', {'entities': [(6, 8, 'VALOR'), (18, 35, 'PRODUTO')]}), ('paguei 5 conto em taxas', {'entities': [(7, 8, 'VALOR'), (18, 23, 'PRODUTO')]}), ('usei 10 reais em gasolina', {'entities': [(5, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('paguei 25 reais por hamburguer', {'entities': [(7, 9, 'VALOR'), (20, 30, 'PRODUTO')]}), ('paguei 20 conto em gasolina', {'entities': [(7, 9, 'VALOR'), (19, 27, 'PRODUTO')]}), ('pizza custou 50 prata', {'entities': [(13, 15, 'VALOR'), (0, 5, 'PRODUTO')]}), ('bar custou 10 prata', {'entities': [(11, 13, 'VALOR'), (0, 3, 'PRODUTO')]}), ('foram 50 reais em livros', {'entities': [(6, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('foram 65 reais em restaurante', {'entities': [(6, 8, 'VALOR'), (18, 29, 'PRODUTO')]}), ('paguei 50 reais por cartão', {'entities': [(7, 9, 'VALOR'), (20, 26, 'PRODUTO')]}), ('usei 45 reais em pizza', {'entities': [(5, 7, 'VALOR'), (17, 22, 'PRODUTO')]}), ('12 reais gastos em posto de gasolina', {'entities': [(0, 2, 'VALOR'), (19, 36, 'PRODUTO')]}), ('usei 35 reais em taxas', {'entities': [(5, 7, 'VALOR'), (17, 22, 'PRODUTO')]}), ('25 reais gastos em restaurante', {'entities': [(0, 2, 'VALOR'), (19, 30, 'PRODUTO')]}), ('30 reais gastos em taxas', {'entities': [(0, 2, 'VALOR'), (19, 24, 'PRODUTO')]}), ('gastei 45 reais em pizza', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('27 reais gastos em cinema', {'entities': [(0, 2, 'VALOR'), (19, 25, 'PRODUTO')]}), ('bar custou 25 prata', {'entities': [(11, 13, 'VALOR'), (0, 3, 'PRODUTO')]}), ('paguei 50 conto em restaurante', {'entities': [(7, 9, 'VALOR'), (19, 30, 'PRODUTO')]}), ('hotel custou 70 prata', {'entities': [(13, 15, 'VALOR'), (0, 5, 'PRODUTO')]}), ('foram 5 reais em sorvete', {'entities': [(6, 7, 'VALOR'), (17, 24, 'PRODUTO')]}), ('foram 40 reais em café', {'entities': [(6, 8, 'VALOR'), (18, 22, 'PRODUTO')]}), ('55 reais gastos em café', {'entities': [(0, 2, 'VALOR'), (19, 23, 'PRODUTO')]}), ('45 reais gastos em mercado', {'entities': [(0, 2, 'VALOR'), (19, 26, 'PRODUTO')]}), ('paguei 55 reais por estacionamento', {'entities': [(7, 9, 'VALOR'), (20, 34, 'PRODUTO')]}), ('mandei 12 reais pra fulano trazer taxas pra gente', {'entities': [(7, 9, 'VALOR'), (34, 39, 'PRODUTO')]}), ('hotel custou 7 prata', {'entities': [(13, 14, 'VALOR'), (0, 5, 'PRODUTO')]}), ('paguei 50 reais por livros', {'entities': [(7, 9, 'VALOR'), (20, 26, 'PRODUTO')]}), ('foram 22 reais em estacionamento', {'entities': [(6, 8, 'VALOR'), (18, 32, 'PRODUTO')]}), ('enviei 60 reais para comprar lanche', {'entities': [(7, 9, 'VALOR'), (29, 35, 'PRODUTO')]}), ('gastei 55 reais em posto de gasolina', {'entities': [(7, 9, 'VALOR'), (19, 36, 'PRODUTO')]}), ('usei 70 reais em livros', {'entities': [(5, 7, 'VALOR'), (17, 23, 'PRODUTO')]}), ('paguei 25 reais por roupa', {'entities': [(7, 9, 'VALOR'), (20, 25, 'PRODUTO')]}), ('mandei 70 reais pra fulano trazer gasolina pra gente', {'entities': [(7, 9, 'VALOR'), (34, 42, 'PRODUTO')]}), ('café custou 12 prata', {'entities': [(12, 14, 'VALOR'), (0, 4, 'PRODUTO')]}), ('posto de gasolina custou 55 prata', {'entities': [(25, 27, 'VALOR'), (0, 17, 'PRODUTO')]}), ('usei 20 reais em farmácia', {'entities': [(5, 7, 'VALOR'), (17, 25, 'PRODUTO')]}), ('lanche custou 35 prata', {'entities': [(14, 16, 'VALOR'), (0, 6, 'PRODUTO')]}), ('paguei 32 reais por mercado', {'entities': [(7, 9, 'VALOR'), (20, 27, 'PRODUTO')]}), ('15 reais gastos em sorvete', {'entities': [(0, 2, 'VALOR'), (19, 26, 'PRODUTO')]}), ('paguei 40 conto em taxas', {'entities': [(7, 9, 'VALOR'), (19, 24, 'PRODUTO')]}), ('mandei 30 reais pra fulano trazer gasolina pra gente', {'entities': [(7, 9, 'VALOR'), (34, 42, 'PRODUTO')]}), ('mandei 27 reais pra fulano trazer lanche pra gente', {'entities': [(7, 9, 'VALOR'), (34, 40, 'PRODUTO')]}), ('foram 18 reais em lanche', {'entities': [(6, 8, 'VALOR'), (18, 24, 'PRODUTO')]}), ('50 reais gastos em farmácia', {'entities': [(0, 2, 'VALOR'), (19, 27, 'PRODUTO')]}), ('lanche custou 35 prata', {'entities': [(14, 16, 'VALOR'), (0, 6, 'PRODUTO')]}), ('foram 7 reais em restaurante', {'entities': [(6, 7, 'VALOR'), (17, 28, 'PRODUTO')]}), ('fix um pix de 30 em bar', {'entities': [(14, 16, 'VALOR'), (20, 23, 'PRODUTO')]}), ('taxi custou 7 prata', {'entities': [(12, 13, 'VALOR'), (0, 4, 'PRODUTO')]}), ('pizza custou 5 prata', {'entities': [(13, 14, 'VALOR'), (0, 5, 'PRODUTO')]}), ('mandei 15 reais pra fulano trazer restaurante pra gente', {'entities': [(7, 9, 'VALOR'), (34, 45, 'PRODUTO')]}), ('usei 50 reais em mercado', {'entities': [(5, 7, 'VALOR'), (17, 24, 'PRODUTO')]}), ('paguei 60 conto em lanche', {'entities': [(7, 9, 'VALOR'), (19, 25, 'PRODUTO')]}), ('mandei 50 reais pra fulano trazer cartão pra gente', {'entities': [(7, 9, 'VALOR'), (34, 40, 'PRODUTO')]}), ('paguei 30 conto em taxi', {'entities': [(7, 9, 'VALOR'), (19, 23, 'PRODUTO')]}), ('paguei 45 reais por taxi', {'entities': [(7, 9, 'VALOR'), (20, 24, 'PRODUTO')]}), ('20 reais gastos em taxi', {'entities': [(0, 2, 'VALOR'), (19, 23, 'PRODUTO')]}), ('foram 10 reais em gasolina', {'entities': [(6, 8, 'VALOR'), (18, 26, 'PRODUTO')]}), ('foram 27 reais em hamburguer', {'entities': [(6, 8, 'VALOR'), (18, 28, 'PRODUTO')]}), ('mercado custou 50 prata', {'entities': [(15, 17, 'VALOR'), (0, 7, 'PRODUTO')]}), ('fix um pix de 18 em pizza', {'entities': [(14, 16, 'VALOR'), (20, 25, 'PRODUTO')]}), ('gasolina custou 15 prata', {'entities': [(16, 18, 'VALOR'), (0, 8, 'PRODUTO')]}), ('foram 50 reais em taxas', {'entities': [(6, 8, 'VALOR'), (18, 23, 'PRODUTO')]}), ('mandei 45 reais pra fulano trazer sorvete pra gente', {'entities': [(7, 9, 'VALOR'), (34, 41, 'PRODUTO')]}), ('usei 5 reais em hamburguer', {'entities': [(5, 6, 'VALOR'), (16, 26, 'PRODUTO')]}), ('fix um pix de 32 em café', {'entities': [(14, 16, 'VALOR'), (20, 24, 'PRODUTO')]}), ('paguei 15 reais por roupa', {'entities': [(7, 9, 'VALOR'), (20, 25, 'PRODUTO')]}), ('foram 32 reais em café', {'entities': [(6, 8, 'VALOR'), (18, 22, 'PRODUTO')]}), ('enviei 15 reais para comprar taxi', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('enviei 70 reais para comprar uber', {'entities': [(7, 9, 'VALOR'), (29, 33, 'PRODUTO')]}), ('livros custou 12 prata', {'entities': [(14, 16, 'VALOR'), (0, 6, 'PRODUTO')]}), ('posto de gasolina custou 60 prata', {'entities': [(25, 27, 'VALOR'), (0, 17, 'PRODUTO')]})]





for _, annotations in train_data:
    for ent in annotations:
        if ent[2] not in ner.labels:
            ner.add_label(ent[2]) 

other_pipes=[pipe for pipe in nlp.pipe_names if pipe!='ner']
with nlp.disable_pipes(*other_pipes):
    optimezer = nlp.begin_training()

    epochs = 50
    for epoch in range(epochs):
        random.shuffle(train_data)
        losses = {}
        batches = minibatch(train_data, size=2)
        for batch in batches:
            examples = []
            for text, annotation in batch:
                doc = nlp.make_doc(text)
                example = Example.from_dict(doc, annotations)
                examples.append(example)
            nlp.update(examples, drop=0.5, losses=losses)   
        #print(f'Epoch {epoch+1}, Losses: {losses}')

nlp.to_disk("meuchat1.0")

trained_nlp = spacy.load("meuchat1.0")

test_texts= [
    "paguei 30 reais em duas pizzas",
    "gastei 24,30 reais no restaurante",
    "gastei 50 reais no posto de gasolina",
    "usei 20 dolares em taxas de cartao"
]

for text in test_texts:
    doc = trained_nlp(text)
    print(f"Text: {text}")
    print("Entities: ", [(ent.text, ent.label) for ent in doc.ents])
